<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Jewellery Shop</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap CSS CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="public/style.css">
</head>
<body>

  <!-- Navbar -->
<nav class="navbar navbar-expand-lg bg-white shadow-sm fixed-top">
  <div class="container">
    <!-- Brand -->
    <a class="navbar-brand fw-bold text-warning" href="#">Jewellery Shop</a>

    <!-- Toggler Button for Mobile -->
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent"
      aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Collapsible Content -->
    <div class="collapse navbar-collapse justify-content-end" id="navbarContent">
      <button class="btn btn-warning text-white" id="loginBtn" data-bs-toggle="modal" data-bs-target="#authModal">
        Login / Signup
        </button>
    <button id="logoutBtn" class="btn btn-danger ms-2">Logout</button>
    </div>
  </div>
</nav>

  <!-- Hero Section -->
    <section class="hero position-relative text-center text-dark">
    <!-- Full-Screen Background Image -->
    <img src="/img/hero.jpg" class="hero-img position-absolute top-0 start-0 w-100 h-100 z-n1" alt="Jewellery Hero Image">

    <!-- Centered Overlay Content -->
    <div class="overlay position-relative d-flex flex-column justify-content-center align-items-center text-white text-shadow py-5" style="min-height: 100vh;">
        <h1 class="display-4 fw-bold text-warning">Shine Bright with Every Sparkle</h1>
        <p class="lead mb-4 fw-bold">Explore our premium collection of handcrafted gold and silver jewellery. Beauty meets elegance here.</p>
        <div class="d-flex gap-3">
          <a href="#" id="customerBtn" class="btn btn-warning btn-lg text-white">Customer Details</a>
          <a href="#" id="invoiceBtn" class="btn btn-secondary btn-lg text-white">Invoice Details</a>
        </div>
    </div>
    </section>

  <!-- Authentication Modal -->
  <div class="modal fade" id="authModal" tabindex="-1" aria-labelledby="authModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <!-- Modal Header -->
        <div class="modal-header">
          <h5 class="modal-title" id="authModalLabel">Login</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <!-- Modal Body -->
        <div class="modal-body">
          <!-- Login Form -->
          <form id="loginForm" method="POST" action="api/auth/login">
            <div class="mb-3">
              <label for="loginEmail" class="form-label">Email address</label>
              <input type="email" class="form-control" id="loginEmail" name="email" required>
            </div>
            <div class="mb-3">
              <label for="loginPassword" class="form-label">Password</label>
              <input type="password" class="form-control" id="loginPassword" name="password" required>
            </div>
            <button type="submit" class="btn btn-warning text-white w-100">Login</button>
            <div class="text-center mt-3">
              <span>Don't have an account? <a href="#" onclick="showSignup()">Signup</a></span>
            </div>
          </form>

          <!-- Signup Form -->
          <form id="signupForm" method="POST" action="api/auth/signup" style="display: none;">
            <div class="mb-3">
              <label for="signupName" class="form-label">Full Name</label>
              <input type="text" class="form-control" id="signupName" name="name" required>
            </div>
            <div class="mb-3">
              <label for="signupEmail" class="form-label">Email address</label>
              <input type="email" class="form-control" id="signupEmail" name="email" required>
            </div>
            <div class="mb-3">
              <label for="signupPassword" class="form-label">Password</label>
              <input type="password" class="form-control" id="signupPassword" name="password" required>
            </div>
            <button type="submit" class="btn btn-warning text-white w-100">Signup</button>
            <div class="text-center mt-3">
              <span>Already have an account? <a href="#" onclick="showLogin()">Login</a></span>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

<div id="dashboardPage" class="container my-5 d-none">
  <h2 class="text-center mb-4 fw-bold">Today’s Metal Prices</h2>
  <div class="row justify-content-center">
    <div class="col-md-5 mb-4">
      <div class="card text-center shadow-sm">
        <div class="card-body">
          <h5 class="card-title fw-semibold">Gold Rate</h5>
          <p id="goldRate" class="display-6 text-warning fw-bold">Loading...</p>
          <a href="/goldestimation" class="btn btn-warning mt-3">Estimate Gold</a>
        </div>
      </div>
    </div>
    <div class="col-md-5 mb-4">
      <div class="card text-center shadow-sm">
        <div class="card-body">
          <h5 class="card-title fw-semibold">Silver Rate</h5>
          <p id="silverRate" class="display-6 text-secondary fw-bold">Loading...</p>
          <a href="/silverestimation" class="btn btn-secondary mt-3">Estimate Silver</a>
        </div>
      </div>
    </div>
  </div>
</div>


  <!-- Bootstrap JS Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Toggle Forms Script -->
<script>
  function showSignup() {
    document.getElementById('loginForm').style.display = 'none';
    document.getElementById('signupForm').style.display = 'block';
    document.getElementById('authModalLabel').innerText = 'Signup';
  }

  function showLogin() {
    document.getElementById('signupForm').style.display = 'none';
    document.getElementById('loginForm').style.display = 'block';
    document.getElementById('authModalLabel').innerText = 'Login';
  }

  window.addEventListener('DOMContentLoaded', () => {
    const isLoggedIn = localStorage.getItem("isLoggedIn") === "true";

    const loginBtn = document.getElementById("loginBtn");
    const logoutBtn = document.getElementById("logoutBtn");

    if (isLoggedIn) {
      loginBtn.style.display = "none";
      logoutBtn.style.display = "inline-block";
      document.getElementById("dashboardPage")?.classList.remove("d-none");
    } else {
      loginBtn.style.display = "inline-block";
      logoutBtn.style.display = "none";
    }
  });

  document.getElementById("loginForm").addEventListener("submit", async function (e) {
    e.preventDefault();

    const email = document.getElementById("loginEmail").value;
    const password = document.getElementById("loginPassword").value;

    try {
      const response = await fetch("/api/auth/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email, password }),
      });

      if (response.ok) {
        localStorage.setItem("isLoggedIn", "true");

        const modal = bootstrap.Modal.getInstance(document.getElementById('authModal'));
        modal.hide();

        document.getElementById("loginBtn").style.display = "none";
        document.getElementById("logoutBtn").style.display = "inline-block";
        document.getElementById("dashboardPage")?.classList.remove("d-none");
      } else {
        const error = await response.text();
        alert("Login failed: " + error);
      }
    } catch (err) {
      alert("Error during login. Try again.");
    }
  });

  // Logout button handler
  document.getElementById("logoutBtn").addEventListener("click", function () {
    localStorage.removeItem("isLoggedIn");
    document.getElementById("loginBtn").style.display = "inline-block";
    document.getElementById("logoutBtn").style.display = "none";
    document.getElementById("dashboardPage")?.classList.add("d-none");
  });

async function fetchMetalRates() {
  try {
    const response = await fetch('https://www.goldapi.io/api/XAU/INR', {
      headers: {
        'x-access-token': 'goldapi-abt0wusmd8dkjms-io',  // Use your actual API key
        'Content-Type': 'application/json'
      }
    });

    const goldData = await response.json();
    const goldPrice = (goldData.price / 31.1035).toFixed(2);

    const silverResponse = await fetch('https://www.goldapi.io/api/XAG/INR', {
      headers: {
        'x-access-token': 'goldapi-abt0wusmd8dkjms-io',
        'Content-Type': 'application/json'
      }
    });

    const silverData = await silverResponse.json();
    const silverPrice = (silverData.price / 31.1035).toFixed(2);

    // Update DOM
    document.getElementById("goldRate").textContent = `₹${goldPrice} / gram`;
    document.getElementById("silverRate").textContent = `₹${silverPrice} / gram`;

  } catch (error) {
    console.error("Error fetching metal rates:", error);
  }
}

document.addEventListener('DOMContentLoaded', () => {
  if (localStorage.getItem("isLoggedIn") === "true") {
    fetchMetalRates();
  }
});

document.addEventListener("DOMContentLoaded", () => {
  const customerBtn = document.getElementById("customerBtn");
  const invoiceBtn = document.getElementById("invoiceBtn");

  function checkLoginAndRedirect(targetUrl) {
    const isLoggedIn = localStorage.getItem("isLoggedIn") === "true";

    if (isLoggedIn) {
      window.location.href = targetUrl;
    } else {
      const loginModal = new bootstrap.Modal(document.getElementById('authModal'));
      loginModal.show();
    }
  }

  if (customerBtn) {
    customerBtn.addEventListener("click", (e) => {
      e.preventDefault();
      checkLoginAndRedirect("/customerdetails");
    });
  }

  if (invoiceBtn) {
    invoiceBtn.addEventListener("click", (e) => {
      e.preventDefault();
      checkLoginAndRedirect("/invoicehistory");
    });
  }
});


</script>

</body>
</html>
